---
layout: default
additional_css: catalogue
---
<div id="catalogue">
  <div class="row">
    <div class="col-12 d-flex align-items-end">
      <h1 class="blue mt-5 mb-3">Les consultations en cours</h1>
      <div class="mb-3 ml-5">
        <button class="btn btn-primary btn-add-consutlation">
          <a target="_blank" href="https://framaforms.org/enregistrer-sa-consultation-au-catalogue-des-consultations-publiques-1551266276">Ajouter une consultation</a>
        </button>
      </div>
    </div>
  </div>
  <div class="form-group row my-3">
    <div class="col-sm-4">
      <input id="search" name="search" placeholder="Recherche rapide" type="text" data-list=".list" class="form-control" >
    </div>

    <!-- filtre spécial -->
    <div class="form-group col-md-2">
      <select name="outils" id="outils" class="form-control" data-list=".list" >
        <option value="">Sélectionner un outil</option>
        {% for outil in site.outil %}
          <option value='{{ outil.title }}'>{{ outil.title }}</option>
        {% endfor %}
      </select>
    </div>
    <!-- fin filtre spécial -->
  </div>

  <!-- <div class="row list" id="results">
    {% for usage in site.usage %}
    {% if usage.in_progress %}
    {% include exemple-card.html usage=usage en-savoir-plus=true %}
    {% endif %}
    {% endfor %}
  </div> -->

  <div class="row list" id="results">
    <div v-for="item in items" class="col-md-4 col-12 mt-4 card-list">
      <div class="card mb-3 card-exemple">
        <div class="content card-header bg-transparent">
          <h5>
            <a class="header" :href="item.fields.url" >{{ item.fields.title }}</a>
          </h5>
          <div class="meta">
            {{ item.fields.description }}
          </div>
        </div>
        <div class="card-body d-flex justify-content-center align-items-center">
          <!-- TODO url image + placeholder dans le champs de recherche -->
          <a v-if="item.fields.screenshot && item.fields.screenshot[0]" :href="item.fields.screenshot[0].url" :style="getImageStyleProperties(item)"></a>
          <!-- "background-image: 'url(/img/' + item.fields.screenshot + ')'; background-size: 'cover';"> -->
        </div>
        <div class="card-footer bg-transparent extra content d-flex justify-content-between align-items-center">
          <div>
            <template v-if="item.fields.outil && item.fields.outil.size > 1" >Outils utilisés</template>
            <template v-else>Outil utilisé</template>
            &nbsp;:
            <template v-for="outilName in item.fields.outil">
                <span v-if="outilName == 'Autre'" class="btn btn-secondary btn-sm outil-title">Autre</span>
                <a v-else class="btn btn-secondary btn-sm outil-title" :href="outilName.url">{{ outilName.title }}</a>
            </template>
            <!-- {% for outilName in include.usage.outil %}
            {% assign outil = site.outil | where: "title", outilName | first %}
              <span v-if="outilName == 'Autre'" class="btn btn-secondary btn-sm outil-title">Autre</span>
              <a v-else class="btn btn-secondary btn-sm outil-title" href="{{ outil.url }}">{{ outil.title }}</a>
            {% endfor %} -->
          </div>
          <!-- <div>
              Outil utilisé{% if item.fields.outil.size > 1 %}s{% endif %}&nbsp;:
              {% for outilName in include.usage.outil %}
              {% assign outil = site.outil | where: "title", outilName | first %}
              {% if outilName == 'Autre' %}
                <span class="btn btn-secondary btn-sm outil-title">Autre</span>
              {% else %}
                <a class="btn btn-secondary btn-sm outil-title" href="{{ outil.url }}">{{ outil.title }}</a>
              {% endif %}
              {% endfor %}
            </div> -->
          <!-- <a v-if=en-savoir-plus class="more" :href="outil.url">En savoir plus</a> -->
        </div>
      </div>
    </div>
    <!-- {% if item['fields']['in_progress'] %}
    {% include exemple-card.html usage=item en-savoir-plus=true %}
    {% endif %} -->

  </div>
</div>

<script type="text/javascript" src="https://unpkg.com/vue"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.16.2/axios.min.js"></script>
<script src="https://cdn.rawgit.com/vdw/HideSeek/master/jquery.hideseek.min.js"></script>

<script>
  $(document).ready(function() {
    $('#search').hideseek({
      nodata: 'Aucun résultat trouvé pour cette recherche',
      ignore_accents: true
    })
    $('#outils').on('change', function() {
      console.log('hello')
      var e = jQuery.Event("keydown");
      e.which = 90; // # Some key code value
      $('#outils').trigger(e);
    })
    $('#outils').hideseek({
      nodata: 'Aucun résultat trouvé pour cette recherche',
      ignore_accents: true,
      navigation: true
    });
  });
</script>

<script type="text/javascript">
  var app = new Vue({
      el: '#catalogue',
      data: {
          items: []
      },
      mounted: function(){
         this.loadItems();
      },
      methods: {
          loadItems: function(){
              // Init variables
              var self = this
              var app_id = "appGm0fBXKeCfIHSH";
              var app_key = "keyXfCXZNCfIupNra";
              this.items = []
                axios.get(
                  "https://api.airtable.com/v0/"+app_id+"/Catalogue?",
                  {
                      headers: { Authorization: "Bearer "+app_key }
                  }
              ).then(function(response){
                  self.items = response.data.records
                  // console.log(JSON.stringify(self.items))
                  // console.log(JSON.stringify(self.items[0].fields.screenshot[0].url))
              }).catch(function(error){
                  console.log(error)
              })
          },
          getImageStyleProperties:function(item){
            return 'background: url(' + item.fields.screenshot[0].url + '); background-size: cover';
          }
      }
  })
</script>